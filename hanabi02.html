<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8">
		<title>打上花火</title>
		<meta name="viewport" content="width=768, height=2000, user-scalable=no"/>
		<script src="js/PhysicalPoint.js"></script>
		<script src="js/ProgrammingBase.js"></script>
<script>
var pt;	//動く点（配列）
var ptFillStyle;
var speed = 100;
var dotlevel = 6;	//円の数
var dotcount = 20;	//１円ごとの点の数
var dotdef = 0.5;	//円の間隔
var eraseSpeed = 0.9;

var eraseFlg;

var status ="wait";

function setup(){
	pt = new Array();
	ptFillStyle = new Array();
	var width = document.getElementById('pbCanvas').width;
	for (var j = 0;j<dotlevel;j++){
		var pttmp = new Array();
		for (var i = 0;i<dotcount;i++){
			pttmp.push(new PhysicalPoint(width/2, width/2));
		}
		pt.push(pttmp);

		if (j%3 == 0){
			ptFillStyle.push(new Array(document.getElementById('color1r').value, document.getElementById('color1g').value, document.getElementById('color1b').value));
		} else if (j%3 == 1){
			ptFillStyle.push(new Array(document.getElementById('color2r').value, document.getElementById('color2g').value, document.getElementById('color2b').value));
		} else {
			ptFillStyle.push(new Array(document.getElementById('color3r').value, document.getElementById('color3g').value, document.getElementById('color3b').value));
		}
	}
	eraseFlg = false;
//	pbCtx.clearRect(0, 0, screenWidth, screenHeight);
}
function loop(){
	if (status != 'start'){
		return;
	}
	//加速
	for (var j = 0;j<dotlevel;j++){
		for (var i = 0;i<dotcount;i++){
			pt[j][i].setKasokudo(
			speed * Math.cos(i/dotcount*2 * Math.PI) * (j+1)*dotdef, 
			speed * Math.sin(i/dotcount*2 * Math.PI) * (j+1)*dotdef);
		}
	}

	//描画
	pbCtx.clearRect(0, 0, screenWidth, screenHeight);
	for (var j = 0;j<dotlevel;j++){
		if (ptFillStyle[j][0] < 5 && ptFillStyle[j][1] < 5 && ptFillStyle[j][2] < 100) continue;

		pbCtx.fillStyle = 'rgb(' + parseInt(ptFillStyle[j][0]) + ',' + parseInt(ptFillStyle[j][1]) + ',' + parseInt(ptFillStyle[j][2]) + ')';
		for (var i = 0;i<dotcount;i++){
			if (pt[j][i].x > screenWidth || pt[j][i].y > screenHeight) {
				eraseFlg = true;
				continue;
			}
			pbCtx.beginPath();
			pbCtx.arc(pt[j][i].x, pt[j][i].y, 6, 0, Math.PI*2, true);
			pbCtx.fill();
		}
		if (eraseFlg){
			ptFillStyle[j][0] = ptFillStyle[j][0] * eraseSpeed;
			ptFillStyle[j][1] = ptFillStyle[j][1] * eraseSpeed;
			ptFillStyle[j][2] = ptFillStyle[j][2] * eraseSpeed;
		}
	}
}

function onPressed(n){}
function onMove(n){}
function onReleased(n){}
</script>
	</head>
	<body>
		色１：<input type="text" size="1" value="256" id="color1r"/><input type="text" size="1" value="0"   id="color1g"/><input type="text" size="1" value="256" id="color1b"/>
		色２：<input type="text" size="1" value="256" id="color2r"/><input type="text" size="1" value="256" id="color2g"/><input type="text" size="1" value="0"   id="color2b"/>
		色３：<input type="text" size="1" value="0"   id="color3r"/><input type="text" size="1" value="256" id="color3g"/><input type="text" size="1" value="256" id="color3b"/>
		<input type="button" id="btnStart" value="開始" onclick="setup(); status='start';"/>
		<input type="button" id="btnStart" value="停止" onclick="status='wait';"/>
		※色＝赤・緑・青　0～256<br/>
		<canvas id="pbCanvas" width="600" height="600" style="background-color:#000066"></canvas>
		<div id="testField" style="position:absolute; left:0px; top:0px; pointer-events:none;"></div>
<br/><a href="./index.html">→</a>
	</body>
</html>